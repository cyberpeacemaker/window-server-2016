<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Show Images from 10.0.1.41</title>
  <style>
    .img-card:hover {
      box-shadow: 0 4px 16px rgba(0,0,0,0.18);
      background: #2465c5;
      transform: scale(1.02);
      transform-origin: center;
      transition: box-shadow 0.25s, background 0.2s, transform 0.2s;
      max-width: none;
    }
    .img-card {
      transition: box-shadow 0.2s, background 0.2s;
      margin-bottom: 24px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      padding: 16px;
      display: flex;
      flex-direction: column;
      max-width: 840px; 
      align-items: center;
    } 
  </style>
</head>
<body>
  <label for="chap-index">Chapter Index:</label>
  <input type="text" id="chap-index" value="03" style="width:64px; margin-right:8px;">
  <label for="start-index">Start Index:</label>
  <input type="number" id="start-index" value="10" min="0" style="margin-right:8px;">
  <button id="load-images-btn">Load Images</button>
  <script>

  </script>
  <h1>Images from 10.0.1.41</h1>
  <div id="image-container">Loading...</div>


<script>  
  const container = document.getElementById('image-container');
  container.innerHTML = '';
  let chapIndex = document.getElementById('chap-index').value;
  let chapName = `LAB${chapIndex}`;
  let startIndex = parseInt(document.getElementById('start-index').value, 10) || 0;  
  document.getElementById('load-images-btn').addEventListener('click', function() {
    container.innerHTML = '';
    startIndex = parseInt(document.getElementById('start-index').value, 10) || 0;
    tryLoadNextImage(startIndex);
  });
  function pad(num, length = 2) {
    return num.toString().padStart(length, '0');
  }
  function createImageCard(filename, url) {
    const card = document.createElement('div');
    card.className = 'img-card';

    const title = document.createElement('div');
    title.textContent = filename;
    title.style.fontWeight = 'bold';
    title.style.marginBottom = '8px';
    title.style.fontSize = '1.4em';

    const img = document.createElement('img');
    img.src = url;
    img.alt = filename;
    img.style.display = 'block';
    img.style.width = '100%';
    img.style.borderRadius = '4px';

    card.appendChild(title);
    card.appendChild(img);

    card.style.cursor = 'pointer';
    card.addEventListener('click', function() {
      const modalBg = document.createElement('div');
      modalBg.style.position = 'fixed';
      modalBg.style.top = '0';
      modalBg.style.left = '0';
      modalBg.style.width = '100vw';
      modalBg.style.height = '100vh';
      modalBg.style.background = 'rgba(0,0,0,0.7)';
      modalBg.style.display = 'flex';
      modalBg.style.alignItems = 'center';
      modalBg.style.justifyContent = 'center';
      modalBg.style.zIndex = '9999';

      const modalImg = document.createElement('img');
      modalImg.src = url;
      modalImg.alt = filename;
      modalImg.style.maxWidth = '90vw';
      modalImg.style.maxHeight = '90vh';
      modalImg.style.boxShadow = '0 4px 32px rgba(0,0,0,0.5)';
      modalImg.style.background = '#fff';
      modalImg.style.borderRadius = '8px';

      modalBg.addEventListener('click', function(e) {
      if (e.target === modalBg) {
        document.body.removeChild(modalBg);
      }
      });

      modalBg.appendChild(modalImg);
      document.body.appendChild(modalBg);
    });    

    return card;
  }
  
  function tryLoadNextImage(index) {    
    const padNum = pad(index, index > 100 ? 3 : 2);
    const url = `http://10.0.1.41/${chapName}-${padNum}.PNG`;
    console.log(url);
    isImageUrlValid(url, function(isValid) {
      if (isValid) {
        const card = createImageCard(`${chapName}-${padNum}.PNG`, url);
        container.appendChild(card);
        // Add a divider line after the card
        const divider = document.createElement('hr');
        divider.style.width = '100%';
        divider.style.margin = '24px 0';
        container.appendChild(divider);        
        tryLoadNextImage(index + 1);
      }
    });
  }
  
  function isImageUrlValid(url, callback) {
    const img = new Image();

    img.onload = function() {
      callback(true);
    };

    img.onerror = function() {
      callback(false);
    };

    img.src = url;
  }
  tryLoadNextImage(startIndex);
</script>

</body>
</html>
